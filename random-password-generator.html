<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Secure Password Generator</title>
    <style>
        /* Modern CSS with Variables */
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-light: #f4f7f6;
            --card-background: #ffffff;
            --text-color: #333;
            --shadow-subtle: 0 6px 20px rgba(0, 0, 0, 0.08);
            --transition-speed: 0.2s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background: var(--card-background);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-subtle);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        /* Input Styling */
        label {
            display: block;
            margin-top: 10px;
            font-weight: 500;
            text-align: left;
            margin-bottom: 5px;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: border-color var(--transition-speed);
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .options {
            margin: 20px 0;
            text-align: left;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .options label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        /* Output and Controls */
        .output-controls {
            display: flex;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 10px;
            align-items: center;
            margin-top: 20px;
        }

        .outputBox {
            flex-grow: 1;
            font-size: 1.1em;
            font-weight: bold;
            word-break: break-all;
            text-align: left;
            padding-right: 10px;
            color: var(--text-color);
        }
        
        /* Copy Button */
        #copyBtn {
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            margin: 0;
            font-size: 1em;
            transition: background-color var(--transition-speed);
        }
        #copyBtn:hover { background-color: #1e7e34; }
        
        /* Strength Meter */
        .strength-meter {
            margin-top: 15px;
            text-align: left;
            font-weight: 500;
        }
        
        .strength-bar-container {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-in-out, background-color 0.3s;
        }
        
        /* Button Style */
        #generateBtn {
            width: 100%;
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 25px;
            transition: background-color var(--transition-speed);
        }

        #generateBtn:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>
    <div class="container">
        <h2>Secure Password Generator</h2>

        <label for="length">Password Length</label>
        <input type="number" id="length" min="4" max="128" value="16" />

        <div class="options">
            <label><input type="checkbox" id="includeUpper" checked /> Uppercase (A-Z)</label>
            <label><input type="checkbox" id="includeLower" checked /> Lowercase (a-z)</label>
            <label><input type="checkbox" id="includeNumbers" checked /> Numbers (0-9)</label>
            <label><input type="checkbox" id="includeSymbols" /> Symbols (!@#$)</label>
            <label><input type="checkbox" id="avoidAmbiguous" /> Avoid Ambiguous (l, 1, I, o, 0, O)</label>
        </div>
        
        <button id="generateBtn">Generate Secure Password</button>

        <div class="output-controls">
            <div class="outputBox" id="passwordResult">Click "Generate"</div>
            <button id="copyBtn">Copy</button>
        </div>
        
        <div class="strength-meter">
            Strength: <span id="strengthText">N/A</span>
            <div class="strength-bar-container">
                <div class="strength-bar" id="strengthBar"></div>
            </div>
        </div>
    </div>

    <script>
        // 2. Constants for characters
        const CHARS = {
            upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
            lower: "abcdefghijklmnopqrstuvwxyz",
            numbers: "0123456789",
            symbols: "!@#$%^&*()_+[]{}|;:,.<>/?",
            ambiguous: "l1Io0O", // Characters to avoid
        };

        const elements = {
            length: document.getElementById("length"),
            includeUpper: document.getElementById("includeUpper"),
            includeLower: document.getElementById("includeLower"),
            includeNumbers: document.getElementById("includeNumbers"),
            includeSymbols: document.getElementById("includeSymbols"),
            avoidAmbiguous: document.getElementById("avoidAmbiguous"),
            generateBtn: document.getElementById("generateBtn"),
            copyBtn: document.getElementById("copyBtn"),
            resultBox: document.getElementById("passwordResult"),
            strengthText: document.getElementById("strengthText"),
            strengthBar: document.getElementById("strengthBar"),
        };
        
        let currentPassword = ''; // Track the generated password

        /**
         * 3. Secure Random Selection
         * Uses crypto.getRandomValues for cryptographically secure random number generation.
         */
        function secureRandom(max) {
            const arr = new Uint32Array(1);
            window.crypto.getRandomValues(arr);
            return arr[0] % max;
        }

        /**
         * 4. Core Generation Logic with Guaranteed Inclusion
         */
        function generatePassword() {
            const length = parseInt(elements.length.value);
            
            const selectedChars = [];
            const mandatoryChars = [];
            let allChars = "";

            // --- Determine character sets and enforce at least one from each selected type ---
            const options = [
                { id: elements.includeUpper, set: CHARS.upper, replace: /[IO]/g },
                { id: elements.includeLower, set: CHARS.lower, replace: /[lo]/g },
                { id: elements.includeNumbers, set: CHARS.numbers, replace: /[10]/g },
                { id: elements.includeSymbols, set: CHARS.symbols, replace: null }, // Symbols don't have standard ambiguous chars
            ];

            options.forEach(option => {
                if (option.id.checked) {
                    let currentSet = option.set;
                    if (elements.avoidAmbiguous.checked && option.replace) {
                        currentSet = currentSet.replace(option.replace, '');
                    }
                    
                    if (currentSet.length > 0) {
                        selectedChars.push(currentSet);
                        mandatoryChars.push(currentSet[secureRandom(currentSet.length)]);
                        allChars += currentSet;
                    }
                }
            });

            if (allChars.length === 0) {
                elements.resultBox.textContent = "Select at least one character type!";
                updateStrength("N/A", 0, "gray");
                return;
            }
            
            // If length is too short for all mandatory chars, cap the mandatory list
            const finalMandatory = mandatoryChars.slice(0, length);
            const remainingLength = length - finalMandatory.length;
            
            let password = "";
            
            // Build the rest of the password
            for (let i = 0; i < remainingLength; i++) {
                password += allChars[secureRandom(allChars.length)];
            }
            
            // Combine mandatory and random characters and shuffle for security
            password = (finalMandatory.join('') + password).split('');
            for (let i = password.length - 1; i > 0; i--) {
                const j = secureRandom(i + 1);
                [password[i], password[j]] = [password[j], password[i]]; // Swap
            }
            currentPassword = password.join('');

            elements.resultBox.textContent = currentPassword;
            checkPasswordStrength(currentPassword, selectedChars.length);
        }

        /**
         * 5. Password Strength Meter Logic (Enhanced Zxcvbn-like)
         */
        function checkPasswordStrength(password, uniqueSets) {
            const minLength = 8;
            const maxScore = 4; // Maximum score achieved by checks
            let score = 0;

            // Length Score (Maximum of 2 points)
            if (password.length >= minLength) score += 1;
            if (password.length >= 12) score += 0.5;
            if (password.length >= 16) score += 0.5;

            // Character Set Score (Maximum of 2 points)
            // Awards points based on the number of unique character types used (max 4)
            score += Math.min(uniqueSets, 4) * 0.5; 
            
            // Clamps the score and sets a floor for short passwords
            score = Math.min(score, maxScore);
            if (password.length < 8) score = 0; // If too short, it's always "Too Weak"

            const strengthMap = {
                0: { text: "Too Weak", color: "#dc3545" }, // Red
                1: { text: "Weak", color: "#ffc107" },     // Yellow
                2: { text: "Good", color: "#17a2b8" },     // Blue
                3: { text: "Excellent", color: "#28a745" },// Green
                4: { text: "Excellent", color: "#28a745" } // Green
            };
            
            // Convert score to an index for the map (0-4)
            const statusIndex = Math.floor(score);
            const status = strengthMap[statusIndex];
            const percentage = (score / maxScore) * 100;
            
            updateStrength(status.text, percentage, status.color);
        }

        /**
         * 6. Strength Meter UI Update
         */
        function updateStrength(text, percentage, color) {
            elements.strengthText.textContent = text;
            elements.strengthBar.style.width = percentage + '%';
            elements.strengthBar.style.backgroundColor = color;
        }

        /**
         * 7. Modern Copy Functionality (navigator.clipboard API)
         */
        async function copyPassword() {
            if (!currentPassword) {
                elements.resultBox.textContent = "Generate a password first!";
                return;
            }
            try {
                await navigator.clipboard.writeText(currentPassword);
                const originalText = elements.copyBtn.textContent;
                elements.copyBtn.textContent = "Copied!";
                elements.copyBtn.style.backgroundColor = '#1e7e34';

                setTimeout(() => {
                    elements.copyBtn.textContent = originalText;
                    elements.copyBtn.style.backgroundColor = var(--secondary-color);
                }, 1000);

            } catch (err) {
                console.error('Failed to copy: ', err);
                elements.resultBox.textContent = "Copy failed (browser permission issue).";
            }
        }

        /**
         * 8. Initialization and Event Listeners
         */
        function initialize() {
            // Attach event listeners using modern methods
            elements.generateBtn.addEventListener('click', generatePassword);
            elements.copyBtn.addEventListener('click', copyPassword);

            // Re-run generator if user changes length or options
            elements.length.addEventListener('change', generatePassword);
            document.querySelectorAll('.options input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', generatePassword);
            });

            // Initial password generation on load
            generatePassword();
        }

        initialize();
    </script>
</body>
</html>
